const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ReusableLineChart-Dg2rkQ1v.js","assets/index-CxY2Q9c1.js","assets/index-B4xW3sFB.css","assets/format-4LxHVCiI.js","assets/colors-BOM4XEf5.js","assets/ReusableLineChart-BDzwuJzT.css"])))=>i.map(i=>d[i]);
import{u as h,s as C,a as A,b as F,r as m,j as e,B as j,c as f,d as L,e as R,f as q,_ as I}from"./index-CxY2Q9c1.js";import{C as O}from"./CustomSelect-Sn4j8iWn.js";import{u as K}from"./useStatistics-sdyndxuz.js";const H="_panel_5vp44_1",Q="_modeToggle_5vp44_9",U="_modeButton_5vp44_19",V="_modeActive_5vp44_41",G="_controls_5vp44_47",J="_input_5vp44_53",X="_adjust_5vp44_91",Y="_actionButtons_5vp44_124",Z="_sellAllWrapper_5vp44_144",o={panel:H,modeToggle:Q,modeButton:U,modeActive:V,controls:G,input:J,adjust:X,actionButtons:Y,sellAllWrapper:Z};function ee(){const t=h(C),a=h(A(t)),{portfolio:d,buy:n,sell:r}=F(),[s,v]=m.useState("long"),[c,p]=m.useState(0),l=1e-4,g=d.find(i=>i.id===t),k=Math.max(g?.amount??0,0),$=Math.max(-(g?.amount??0),0),_=s==="long"?k:$,x=f[t]||t,S=()=>p(i=>Math.max(Math.round((i-l)*1e5)/1e5,0)),z=()=>p(i=>Math.round((i+l)*1e5)/1e5),B=i=>{const D=Math.max(Number(i),0);p(Math.round(D*1e5)/1e5)},W=()=>{!t||a<=0||c<=0||n(t,x,a,c,s)},w=()=>{!t||c<=0||r(t,x,a,c,s)},E=()=>{if(!(!t||_<=0)){if(s==="long"){r(t,x,a,_,s);return}n(t,x,a,_,s)}},y=a<=0||c<=0,N=a<=0||c<=0||c>_,M=s==="short"?"Покрыть":"Купить",P=s==="short"?"Шорт":"Продать",T=s==="short"?"Покрыть всё":"Продать всё";return e.jsxs("div",{className:o.panel,children:[e.jsxs("div",{className:o.modeToggle,role:"tablist","aria-label":"Режим позиции",children:[e.jsx("button",{type:"button",className:`${o.modeButton} ${s==="long"?o.modeActive:""}`,onClick:()=>v("long"),"aria-pressed":s==="long",children:"Лонг"}),e.jsx("button",{type:"button",className:`${o.modeButton} ${s==="short"?o.modeActive:""}`,onClick:()=>v("short"),"aria-pressed":s==="short",children:"Шорт"})]}),e.jsxs("div",{className:o.controls,children:[e.jsx("button",{type:"button",className:o.adjust,onClick:S,children:"-"}),e.jsx("input",{type:"number",value:c.toFixed(4),min:0,step:l,onChange:i=>B(i.target.value),className:o.input}),e.jsx("button",{type:"button",className:o.adjust,onClick:z,children:"+"})]}),e.jsxs("div",{className:o.actionButtons,children:[e.jsx(j,{variant:"primary",size:"md",onClick:W,disabled:s==="short"?N:y,children:M}),e.jsx(j,{variant:"danger",size:"md",onClick:w,disabled:s==="short"?y:N,children:P})]}),e.jsx("div",{className:o.sellAllWrapper,children:e.jsx(j,{fullWidth:!0,variant:"warning",size:"md",onClick:E,disabled:_<=0||a<=0,children:T})})]})}const te=(t,a=1)=>{const{showSnackbar:d}=L(),n=m.useRef(null),r=R({queryKey:["chart",t,a],queryFn:()=>q(t,a),staleTime:6e4,refetchInterval:!1,retry:1});return m.useEffect(()=>{if(!r.isError){n.current=null;return}const s=r.error instanceof Error?r.error.message:"Ошибка при загрузке графика";n.current!==s&&(n.current=s,d(s,"error"))},[r.isError,r.error,d]),r},se="_skeleton_w7znu_1",ae={skeleton:se},re=m.lazy(()=>I(()=>import("./ReusableLineChart-Dg2rkQ1v.js"),__vite__mapDeps([0,1,2,3,4,5])));function oe(){const t=h(C),{data:a}=te(t,1);return e.jsx(m.Suspense,{fallback:e.jsx("div",{className:ae.skeleton}),children:e.jsx(re,{data:a,dataKey:"price",title:`График цены ${t.toUpperCase()}`,height:300})})}const ne="_headerDashboard_13zv1_1",le="_dashboardWrapper_13zv1_9",ce="_card_13zv1_20",de="_cardContent_13zv1_156",ie="_mono_13zv1_172",u={headerDashboard:ne,dashboardWrapper:le,card:ce,cardContent:de,mono:ie},ue=({label:t,value:a,color:d,custom:n})=>e.jsxs("div",{className:u.card,children:[e.jsx("h4",{children:t}),n&&e.jsx("div",{className:u.cardContent,children:n}),a!==void 0&&e.jsx("div",{className:u.cardContent,children:e.jsx("p",{className:u.mono,style:{color:d||"var(--text-color)"},children:a})})]});function he(){const{balance:t,realizedProfit:a,unrealizedProfit:d,operationsCount:n}=K(),r=h(C),s=h(l=>l.setSelectedAsset),v=h(A(r)),c=Object.keys(f).map(l=>({value:l,label:f[l]})),p=[{label:"Баланс",value:`$ ${t.toFixed(2)}`},{label:"Актив",custom:e.jsx(O,{fullWidth:!0,value:r,options:c,onChange:s,ariaLabel:"Выбор актива"})},{label:"Стоимость актива",value:`$ ${v.toFixed(2)}`},{label:"Реализовано",value:`$ ${a.toFixed(2)}`,color:a>=0?"var(--primary-color)":"var(--error-color)"},{label:"В позициях",value:`$ ${d.toFixed(2)}`,color:d>=0?"var(--primary-color)":"var(--error-color)"},{label:"Операций",value:n}];return e.jsx("div",{className:u.headerDashboard,children:e.jsx("div",{className:u.dashboardWrapper,children:p.map(l=>e.jsx(ue,{...l},l.label))})})}const me="_container_1x52e_13",pe="_tradeChart_1x52e_27",b={container:me,tradeChart:pe,"trade-panel-wrapper":"_trade-panel-wrapper_1x52e_43","chart-wrapper":"_chart-wrapper_1x52e_45"};function be(){return e.jsxs("div",{className:b.container,children:[e.jsx(he,{}),e.jsxs("div",{className:b.tradeChart,children:[e.jsx("div",{className:b["trade-panel-wrapper"],children:e.jsx(ee,{})}),e.jsx("div",{className:b["chart-wrapper"],children:e.jsx(oe,{})})]})]})}export{be as default};
